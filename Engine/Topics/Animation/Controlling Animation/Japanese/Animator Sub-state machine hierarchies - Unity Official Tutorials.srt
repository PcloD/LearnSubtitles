1
00:00:00,163 --> 00:00:02,164
アニメーターコントローラー内で複雑な

2
00:00:02,164 --> 00:00:04,623
ステートを含むロジックシステムを作成するとき

3
00:00:04,623 --> 00:00:06,623
ステートマシンを階層化すると

4
00:00:06,623 --> 00:00:08,623
とてもきれいに整理できます

5
00:00:08,883 --> 00:00:10,883
ステートマシンを作成するには Animator ウィンドウで

6
00:00:10,883 --> 00:00:13,125
何もない箇所を右クリックして

7
00:00:13,125 --> 00:00:15,656
Create Sub-State Machine（サブステートマシンを作成）をクリックします

8
00:00:21,146 --> 00:00:23,213
これで現在のレイヤーまたはステートマシンレベルに

9
00:00:23,213 --> 00:00:25,213
新しいステートマシンが作成されます

10
00:00:25,665 --> 00:00:28,326
標準の四角っぽい形とは異なり

11
00:00:28,326 --> 00:00:31,019
サブステートマシンは六角形っぽい形を

12
00:00:31,019 --> 00:00:32,607
していますね

13
00:00:32,607 --> 00:00:35,271
それでは 便利な使い方を見ていきましょう

14
00:00:36,021 --> 00:00:38,021
ここにちょっと ごちゃごちゃしてきた

15
00:00:38,021 --> 00:00:39,741
アニメーターコントローラーがあります

16
00:00:39,741 --> 00:00:42,268
ここにさらにステートを追加していく前に

17
00:00:42,268 --> 00:00:43,931
整理しておきたいところです

18
00:00:43,931 --> 00:00:45,931
それには一部のステートを

19
00:00:45,931 --> 00:00:47,931
ステートマシンに入れてしまう方法があります

20
00:00:47,931 --> 00:00:49,931
この例だとAirborne（空中）にいる時の

21
00:00:49,931 --> 00:00:52,250
ステートのグループはすべて

22
00:00:52,250 --> 00:00:54,144
サブステートマシンにまとめられそうです

23
00:00:54,144 --> 00:00:56,442
さっそくステートマシンを作るため

24
00:00:56,442 --> 00:00:58,442
Animator ウィンドウを右クリックして

25
00:00:58,442 --> 00:01:01,990
Create Sub-State Machine を選択します

26
00:01:04,605 --> 00:01:06,605
ステートマシンの名前はインスペクターで

27
00:01:06,605 --> 00:01:08,605
クリックすればいつでも変更できます

28
00:01:08,605 --> 00:01:10,317
ステートと同じですね

29
00:01:11,403 --> 00:01:14,191
次に作ったステートマシンにステートを追加していきますが

30
00:01:14,778 --> 00:01:16,278
これは追加するステートを選択して

31
00:01:16,278 --> 00:01:18,278
ステートマシンにドラッグするだけで

32
00:01:18,278 --> 00:01:20,075
OK です

33
00:01:20,075 --> 00:01:22,858
この例でステートマシンに含めたいのは Leap Takeoff

34
00:01:22,858 --> 00:01:26,469
Leap Airborne・Falling・Landing ステートです

35
00:01:27,267 --> 00:01:29,267
ドラッグ中には追加できる場合に + アイコンが

36
00:01:29,267 --> 00:01:31,267
表示されるので注意してください

37
00:01:35,430 --> 00:01:37,866
こうしてステートをステートマシンに追加すると

38
00:01:37,866 --> 00:01:40,745
現在のステートマシン / レイヤーからは消えてしまいます

39
00:01:41,226 --> 00:01:43,226
もう一度これらステートを表示したり

40
00:01:43,226 --> 00:01:45,226
プロパティを編集したりするには

41
00:01:45,495 --> 00:01:48,041
サブステートマシンをダブルクリックします

42
00:01:51,079 --> 00:01:52,945
格納レイヤーやステートマシンに

43
00:01:52,945 --> 00:01:55,989
戻る場合は「Up」ノードをダブルクリックします

44
00:01:56,345 --> 00:01:58,345
現在どの階層にいるのかはウィンドウの上部に

45
00:01:58,345 --> 00:02:00,345
パンくず式で表示されるので

46
00:02:00,345 --> 00:02:01,855
そこで確認してください

47
00:02:09,028 --> 00:02:12,232
さてステートマシンは階層構造で使うことができます

48
00:02:12,232 --> 00:02:14,415
これはつまりアニメーターコントローラーの各レイヤーには

49
00:02:14,415 --> 00:02:17,310
複数のステートマシンが存在しうるということです

50
00:02:17,916 --> 00:02:19,916
そしてそのステートマシーンにもさらに

51
00:02:19,916 --> 00:02:22,314
サブステートマシンを持たせることなどができます

52
00:02:25,570 --> 00:02:28,150
そして遷移（Transition）はステートマシンの

53
00:02:28,150 --> 00:02:30,150
外部から内部へと移動できます

54
00:02:30,477 --> 00:02:32,477
この例でもサブステートマシンに格納した

55
00:02:32,477 --> 00:02:35,048
ステートへの遷移がそのまま維持されている

56
00:02:35,048 --> 00:02:38,568
のが見えますね

57
00:02:43,740 --> 00:02:46,192
ステートマシンに新しい遷移を追加するには

58
00:02:46,192 --> 00:02:48,192
遷移元とするステートまたはステートマシンを

59
00:02:48,192 --> 00:02:49,903
右クリックし 続けて

60
00:02:49,903 --> 00:02:51,903
Make Transition（遷移を作成）を選択します

61
00:02:52,470 --> 00:02:54,470
続けて遷移先のステートマシンを

62
00:02:54,470 --> 00:02:56,097
左クリックします

63
00:02:57,008 --> 00:02:59,219
するとポップアップメニューが表示され

64
00:02:59,219 --> 00:03:01,872
ステートマシン内のどのステートに遷移させるか

65
00:03:01,872 --> 00:03:05,016
あるいはステートマシン自体に遷移させるかを

66
00:03:05,449 --> 00:03:07,449
指定するよう求められます

67
00:03:10,054 --> 00:03:12,054
ステートマシンから出る遷移を作る方法としては

68
00:03:12,054 --> 00:03:14,188
「Up」ノードを使う方法があります

69
00:03:14,188 --> 00:03:16,188
これは現在のステートマシンに含まれない

70
00:03:16,188 --> 00:03:18,188
全ステート/ステートマシンへの

71
00:03:18,188 --> 00:03:19,986
リンクのように機能します

72
00:03:20,371 --> 00:03:22,246
Up ノードにはまず「Up」ラベルが

73
00:03:22,246 --> 00:03:24,476
続いて親ステートマシンの名前が表示されています

74
00:03:25,091 --> 00:03:27,091
親ステートマシンが存在しない場合は

75
00:03:27,091 --> 00:03:29,091
帰属するレイヤーの名前が表示されます

76
00:03:29,697 --> 00:03:31,697
この例では親ステートマシンがないので

77
00:03:31,697 --> 00:03:34,063
Up ノードのラベルは次のようになっています

78
00:03:34,063 --> 00:03:35,717
(Up) Base Layer

79
00:03:35,717 --> 00:03:38,176
ステートマシンから出る遷移を作るには

80
00:03:38,176 --> 00:03:40,176
遷移元とするステート / ステートマシンを

81
00:03:40,176 --> 00:03:41,928
右クリックしてから

82
00:03:42,312 --> 00:03:44,513
Make Transition（遷移を作成）を選択し

83
00:03:44,513 --> 00:03:46,513
続けて Up ノードを左クリックします

84
00:03:47,789 --> 00:03:49,789
するとステートマシンに遷移する時と似た

85
00:03:49,789 --> 00:03:52,515
オプションが表示されます

86
00:03:52,515 --> 00:03:54,515
ただしこの場合選択肢としては

87
00:03:54,515 --> 00:03:56,361
現在よりも上の階層のステートマシンや

88
00:03:56,361 --> 00:03:57,829
ステートが表示されます

89
00:04:00,059 --> 00:04:02,059
レイヤー / ステートマシンには必ず

90
00:04:02,059 --> 00:04:05,122
緑色の Entry と赤色の Exit ノードが存在します

91
00:04:05,371 --> 00:04:07,650
これらは他のステートやステートマシンへの

92
00:04:07,650 --> 00:04:09,650
依存性を抑える目的でカプセル化する

93
00:04:09,650 --> 00:04:11,650
ために用いられ

94
00:04:11,650 --> 00:04:14,436
Up ノードの代替物のように扱うことができます

95
00:04:14,791 --> 00:04:16,791
ステートマシンを遷移先とする場合も遷移元とする場合も

96
00:04:16,791 --> 00:04:18,791
ユーザーは Up ノード /

97
00:04:18,791 --> 00:04:20,427
Entry ノード / Exit ノードを使えます

98
00:04:20,945 --> 00:04:22,347
Up ノードを使った場合

99
00:04:22,347 --> 00:04:24,347
遷移はステート間または

100
00:04:24,347 --> 00:04:27,375
ステートとステートマシンの間で起こります

101
00:04:27,740 --> 00:04:30,039
Entry および Exit ノードを使った場合

102
00:04:30,039 --> 00:04:32,039
遷移元も遷移先も

103
00:04:32,039 --> 00:04:34,039
ステートマシン自体となります

104
00:04:34,039 --> 00:04:36,039
ステートマシンへの遷移は

105
00:04:36,039 --> 00:04:38,039
Entry ノードから来て

106
00:04:38,960 --> 00:04:40,960
Exit ノードから出て行くわけです

107
00:04:48,436 --> 00:04:50,050
そうなると遷移の設計も色々と

108
00:04:50,050 --> 00:04:51,847
考慮しなくてはいけない点が出てきます

109
00:04:51,847 --> 00:04:54,652
Up ノードのように単一の遷移が入っているだけでなく

110
00:04:54,652 --> 00:04:56,048
多数の遷移が存在しうるからです

111
00:04:56,048 --> 00:04:58,048
例を見てみましょう

112
00:04:58,048 --> 00:05:01,279
これは先ほど見ていたコントローラーと同じものです

113
00:05:03,244 --> 00:05:05,693
ただし Locomotion と Airborne はそれぞれ

114
00:05:05,693 --> 00:05:08,049
個別のステートマシン化されています

115
00:05:09,190 --> 00:05:11,190
そして先ほどのように各ステートを

116
00:05:11,190 --> 00:05:13,190
遷移でつなぐのではなく

117
00:05:13,190 --> 00:05:15,506
Entry ノードと Exit ノードが使われています

118
00:05:15,506 --> 00:05:17,506
先ほどの例では Standing Locomotion から

119
00:05:17,506 --> 00:05:21,242
Leap Take Off と Falling への遷移があり

120
00:05:23,641 --> 00:05:25,641
また Landing から

121
00:05:25,641 --> 00:05:27,641
Standing Locomotion への遷移もありました

122
00:05:29,455 --> 00:05:31,455
Standing Locomotion から Leap Take Off への

123
00:05:31,455 --> 00:05:34,397
遷移条件は Jump トリガーでした

124
00:05:35,952 --> 00:05:37,952
しかし Locomotion ステートを

125
00:05:37,952 --> 00:05:40,355
ステートマシンにカプセル化したので

126
00:05:40,355 --> 00:05:42,355
遷移先のステートは無関係になって

127
00:05:42,355 --> 00:05:43,758
しまっています

128
00:05:43,758 --> 00:05:45,758
この場合ただこのステートマシンから

129
00:05:45,758 --> 00:05:47,758
出たいという状態になります

130
00:05:47,998 --> 00:05:49,998
なので Exit ノードへの遷移で

131
00:05:49,998 --> 00:05:51,998
条件に Jump トリガーを指定します

132
00:05:57,112 --> 00:05:59,361
さて先ほどの複雑なアニメーターコントローラーでは

133
00:05:59,361 --> 00:06:01,361
Standing Locomotion から Falling へ

134
00:06:01,361 --> 00:06:03,361
遷移する条件はパラメーター

135
00:06:03,361 --> 00:06:05,361
"Grounded" が false の時でした

136
00:06:06,781 --> 00:06:08,781
そして Entry / Exit ノードの例でも

137
00:06:08,781 --> 00:06:10,781
2 個目の遷移で Locomotion ステートマシンを

138
00:06:10,781 --> 00:06:13,820
出るときに同じ条件が必要になります

139
00:06:21,074 --> 00:06:23,431
ステートマシンは 2 個しかないので

140
00:06:23,431 --> 00:06:26,222
一方のステートマシンを出るときは

141
00:06:26,222 --> 00:06:27,769
他方に入るようにしたいですよね

142
00:06:28,491 --> 00:06:32,204
このため両者間の遷移には条件をつけません

143
00:06:33,528 --> 00:06:35,789
さて Airborne ステートマシンには Entry ノードから

144
00:06:35,789 --> 00:06:37,789
2 個の遷移が出ています

145
00:06:38,480 --> 00:06:40,480
1 個目は Entry ノードからの

146
00:06:40,480 --> 00:06:42,067
デフォルトの遷移です

147
00:06:42,067 --> 00:06:44,616
デフォルトであるのは矢印が通常の白ではなく

148
00:06:44,616 --> 00:06:46,616
オレンジ色であるところから分かります

149
00:06:47,374 --> 00:06:49,759
この遷移は他に Entry ノードから

150
00:06:49,759 --> 00:06:51,759
移行できる遷移がない時または

151
00:06:51,759 --> 00:06:54,113
この遷移のみが利用可能なときに使われます

152
00:06:54,594 --> 00:06:56,392
もう一方の遷移はグレーになっていますね

153
00:06:56,757 --> 00:06:58,757
このようにグレーで表示される遷移は

154
00:06:58,757 --> 00:07:00,757
遷移元のステートがわからないことを

155
00:07:00,757 --> 00:07:02,332
示します

156
00:07:02,332 --> 00:07:03,910
この例で言えば

157
00:07:03,910 --> 00:07:05,910
Entry ノードからステートマシンへの

158
00:07:05,910 --> 00:07:08,245
遷移であるため 遷移元のステートは

159
00:07:08,245 --> 00:07:11,640
何でもあり得ます

160
00:07:11,915 --> 00:07:14,541
この他にも Locomotion と Airborne の

161
00:07:14,541 --> 00:07:17,518
両ステートマシン間の遷移もグレーで表示されています

162
00:07:19,504 --> 00:07:21,504
これらも同様に 遷移元のステートが

163
00:07:21,504 --> 00:07:23,504
不明であるためグレーなのです

164
00:07:24,617 --> 00:07:26,617
グレーになっている遷移では

165
00:07:26,617 --> 00:07:28,617
条件のみが編集可能です

166
00:07:29,164 --> 00:07:31,164
遷移元のステートが分からない状態では

167
00:07:31,164 --> 00:07:33,164
その他の詳細設定は

168
00:07:33,164 --> 00:07:35,164
意味がありませんから

169
00:07:35,164 --> 00:07:38,047
持続時間やその他の情報を制御する際は

170
00:07:38,047 --> 00:07:40,956
遷移元のステートからの遷移を使います

171
00:07:43,374 --> 00:07:45,374
Falling への遷移の条件には

172
00:07:45,374 --> 00:07:47,374
"Grounded" が false と設定されています

173
00:07:47,691 --> 00:07:49,546
この 2 つの遷移は組み合わせて考えると

174
00:07:49,546 --> 00:07:51,546
このステートマシンに入った時 "grounded" が false であれば

175
00:07:51,546 --> 00:07:54,259
Falling が再生されるという結果が得られます

176
00:07:55,343 --> 00:07:58,353
そしてそれ以外の場合はデフォルトの遷移が使用され

177
00:07:58,360 --> 00:08:00,360
"Leap Take Off" が再生されます

178
00:08:01,610 --> 00:08:03,610
Entry / Exit ノードを使用してステートマシンを

179
00:08:03,610 --> 00:08:05,610
カプセル化することの最大の利点は

180
00:08:05,610 --> 00:08:07,466
その再利用性にあります

181
00:08:07,466 --> 00:08:09,466
特定のアニメーターコントローラーに

182
00:08:09,466 --> 00:08:11,466
他の場所でも使えるステートマシンがあった時

183
00:08:11,831 --> 00:08:14,158
ステートマシンをそのまま別の

184
00:08:14,158 --> 00:08:16,158
アニメーターコントローラーにコピーできるからです

185
00:08:16,158 --> 00:08:18,544
ステートマシンは自己完結型であり

186
00:08:18,544 --> 00:08:21,803
外部への依存性を持たないので

187
00:08:21,803 --> 00:08:23,803
コピー先の別のアニメーター

188
00:08:23,803 --> 00:08:25,803
で他のステートやステートマシンが

189
00:08:25,803 --> 00:08:27,189
どうなっていても関係ないわけです

190
00:08:27,189 --> 00:08:29,189
アニメーターとアニメーターコントローラーの

191
00:08:29,189 --> 00:08:32,168
詳細については下記リンク先の情報をご覧ください
